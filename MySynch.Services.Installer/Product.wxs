<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
	<Product Id="4cdac2c8-7fab-41d4-9fdd-9838fcd21b39" Name="MySynch" Language="1033" Version="1.5.0.0" Manufacturer="Sciendo Limited" UpgradeCode="96d40af2-71e0-4058-b382-09713c1b31ce">
		<Package InstallerVersion="200" Compressed="yes" />
	 
		<Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />
		<PropertyRef Id="NETFRAMEWORK40FULL"></PropertyRef>
    <Property Id="SRCROOTDIRVAL" Value="C:\"/>
    <Property Id="DSTROOTDIRVAL" Value="C:\"/>
    <Property Id="BRKURLVAL" Value="http://sciendo-laptop/broker/"/>
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch MySynch Monitor" />

    <Condition Message='This setup requires the .NET Framework 4.0 installed.'>
			<![CDATA[Installed OR NETFRAMEWORK40FULL]]>
		</Condition>
		<Directory Id="TARGETDIR" Name="SourceDir">
		 <Directory Id="ProgramFilesFolder">
				<Directory Id="Sciendo" Name="Sciendo">
					<Directory Id="INSTALLLOCATION" Name="MySynch">
						<Directory Id ="PUBLISHER" Name="Publisher"/>
						<Directory Id ="SUBSCRIBER" Name="Subscriber"/>
						<Directory Id ="BROKER" Name="Broker"/>
            <Directory Id="MONITOR" Name="Monitor"/>
					</Directory>
				</Directory>
			</Directory>
    <Directory Id="ProgramMenuFolder" Name="Programs">
      <Directory Id="ProgramMenuDir" Name="MySynch">
        <Component Id="ProgramMenuDir" Guid="{26F451D3-B079-4BBD-80BE-0E836BE7C34E}">
          <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
          <RegistryValue Root="HKCU" Key="Software\Sciendo\MySynch" Type="string" Value="" KeyPath="yes" />
        </Component>
      </Directory>
    </Directory>
	  <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>
    <Feature Id="Complete" Title="All MySynch Services" Display="expand" Level="1" ConfigurableDirectory="INSTALLLOCATION" AllowAdvertise="no">
      <ComponentGroupRef Id="MonitorGroup"/>
      <ComponentGroupRef Id="MonitorGroupConf"/>
      <ComponentRef Id="ProgramMenuDir"/>
      <Feature Id="PUBLISHER" Title="MySynch Publisher" Level="1" ConfigurableDirectory="PUBLISHER">
	      <ComponentGroupRef Id="PublisherGroup"/>
	      <ComponentGroupRef Id="PublisherGroupConf"/>
	    </Feature>
	    <Feature Id="Subscriber" Title="MySynch Subscriber" Level="1" ConfigurableDirectory="SUBSCRIBER">
	      <ComponentGroupRef Id="SubscriberGroup"/>
	      <ComponentGroupRef Id="SubscriberGroupConf"/>
	    </Feature>
	    <Feature Id="Broker" Title="MySynch Broker" Level="1" ConfigurableDirectory="BROKER">
	      <ComponentGroupRef Id="BrokerGroup"/>
	      <ComponentGroupRef Id="BrokerGroupConf"/>
	    </Feature>
	  </Feature>
    <UI Id="MyWixUI_Mondo">
      <UIRef Id="WixUI_FeatureTree" />
      <DialogRef Id="MySynchDlg" />
      <Publish Dialog="CustomizeDlg" Control="Next" Event="NewDialog" Value="MySynchDlg" Order="1">&amp;PUBLISHER=3 AND &amp;Subscriber=3</Publish>
      <Publish Dialog="ExitDialog"
    Control="Finish"
    Event="DoAction"
    Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
    </UI>
    <!-- Step 3: Include the custom action -->
    <Property Id="WixShellExecTarget" Value="[#MySynch.Monitor.exe]" />
    <CustomAction Id="LaunchApplication"
        BinaryKey="WixCA"
        DllEntry="WixShellExec"
        Impersonate="yes" />
  </Product>
</Wix>
